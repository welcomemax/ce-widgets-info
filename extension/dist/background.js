!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=29)}({20:function(t,e){fetch("https://apps.elfsight.com/api/v1/public/applications/").then(t=>t.json()).then(t=>{const e=t.data.map(t=>({name:t.name,slug:t.alias,aliases:[t.alias,t.name],version:{last:t.version?t.version:"1.0.0"},icon:t.icon}));chrome.storage.local.set({apps:e})})},29:function(t,e,s){"use strict";s.r(e);s(20);class i{constructor(){}postMessageFactory(t){t&&t.method&&(t.data?this[t.method](t.data):this[t.method]())}getQueryParam(t,e){t=t.replace(/[\[\]]/g,"\\$&");let s=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}}new class{constructor(){this.widgets={},this.sites={},this.tabs={},this.tab={},this.tabWidgets=[],this.tab_port=null,this.popup_port=null,this.utils=new i,this.init()}init(){chrome.extension.onConnect.addListener(e=>{this.popup_port=e,this.popup_port.onMessage.addListener(t)}),chrome.tabs.onUpdated.addListener((e,s,i)=>{if(s&&s.status&&"complete"===s.status.toLowerCase()){if(!(e&&i&&i.url&&i.url.indexOf("http")+1))return;this.tab=i,this.tab.site=i.url.match(/^(?:https?:)?(?:\/\/)?(?:w+\.)?([^\/\?]+)/)[1],this.tabs[i.id]||(this.tabs[i.id]={id:i.id,site:i.site,url:i.url,title:i.title,favIconUrl:i.favIconUrl}),this.sites[i.site]||(this.sites[i.site]={site:i.site,pages:{}}),this.sites[i.site].pages[i.url]||(this.sites[i.site].pages[i.url]={url:i.url,widgets:[]}),this.tab_port=chrome.tabs.connect(this.tab.id),this.tab_port.onMessage.addListener(t),"partners.shopify.com"===this.tab.site&&this.tab.url.match(/managed_stores\/new/)&&this.postMessage(this.tab_port,"utilsSetManagedStore",{store_url:this.utils.getQueryParam("store_url",i.url),permissions:this.utils.getQueryParam("permissions",i.url).split(","),message:this.utils.getQueryParam("message",i.url)}),this.postMessage(this.tab_port,"postMessageWidgets")}}),chrome.tabs.onActivated.addListener(t=>{this.tab=this.tabs[t.tabId],this.postMessageReturnTabWidgets()});let t=t=>{t&&t.method&&(t.data?this[t.method](t.data):this[t.method]())}}setBadge(t){chrome.browserAction.setBadgeText({text:t?t.toString():""}),t||chrome.browserAction.setBadgeBackgroundColor({color:"#38393a"})}postMessageReturnTabWidgets(t){t&&this.storeWidgets(t),this.tab&&this.widgets[this.tab.id]?(this.tabWidgets=this.widgets[this.tab.id],this.setBadge(this.widgets[this.tab.id].length)):(this.tabWidgets=[],this.setBadge(0)),this.popup_port&&this.postMessage(this.popup_port,"postMessageSetTabWidgets",this.tabWidgets)}postMessage(t,e,s){let i={method:e};s&&(i.data=s),t.postMessage(i)}postMessageRequestAllData(){this.postMessage(this.popup_port,"postMessageSetAllData",{tabs:this.tabs,sites:this.sites,widgets:this.widgets})}postMessageRequestTabWidgets(){this.postMessage(this.popup_port,"postMessageSetTabWidgets",this.tabWidgets)}storeWidgets(t){this.widgets[this.tab.id]=t}}}});